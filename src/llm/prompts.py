# -*- coding: utf-8 -*-

def create_comparison_prompt(diff_report: str, hist_name: str, latest_name: str) -> str:
    """构建双版本比对分析的Prompt。"""
    return (
        f"### **分析任务：精确比对历史与最新数据**\n"
        f"**历史版本**: `{hist_name}`\n"
        f"**最新版本**: `{latest_name}`\n"
        f"---\n"
        f"#### **数据差异项**\n"
        f"以下是由高精度比对模块生成的详细变更日志。\n"
        f"```text\n{diff_report}\n```\n"
        f"---\n"
        f"### **你的任务**\n"
        "作为一名资深数据分析专家，请基于以上精确、详细的变更日志，撰写一份分析报告。报告必须包含以下部分：\n"
        "1.  **变更摘要解读**: 基于日志开头的“对比摘要”，概括本次数据变更的总体情况。\n"
        "2.  **关键风险识别**: 从详细的【修改】记录中，识别并列出最值得关注或潜在风险最高的变更。\n"
        "3.  **结论与建议**: 综合所有信息，给出初步结论，并提供初步建议。"
    )

def create_historical_prompt(
    md_trace_table: str,
    summary_line: str,
    source_names: str,
    value_column: str,
    top_n: int
) -> str:
    """构建多版本历史追溯分析的Prompt。"""
    return (
        f"### **分析任务：数据质量链式追溯综合分析**\n"
        f"**分析对象**: 从 `{source_names}` 的演变过程中的核心指标 `{value_column}`。\n"
        f"---\n"
        f"#### **1. Top {top_n} 显著异常变更记录**\n"
        f"为保证分析质量和聚焦重点，系统已通过'异常得分'(综合修改频率和变化幅度)预筛选出以下最值得关注的记录，请你基于**此表**进行分析：\n"
        f"{md_trace_table}\n"
        f"---\n"
        f"#### **2. 记录级别变更摘要 (仅对比首尾版本)**\n"
        f"{summary_line}\n"
        f"---\n"
        f"### **你的任务**\n"
        "作为一名资深数据质量分析专家，请严格根据上方提供的【显著异常变更记录】表格，撰写一份精准、无遗漏的分析报告。报告必须包含：\n"
        "1.  **高频/高风险变动识别**: **完整列出并分析**上表中所有【总修改次数】最高的记录。如果有多条记录的修改次数并列最高，必须全部列出。\n"
        "2.  **显著异常项分析**: 从上表中，识别并分析变化最剧烈或模式最可疑的记录。并描述其变化特征（例如：瞬间暴涨后回落、持续大幅下跌等）。\n"
        "3.  **初步结论**: 综合以上分析，对这些异常数据的可能原因进行归类和推断（例如：可能是数据补录错误、设备故障、正常的业务波动等）。\n"
        "4.  **核查建议**: 基于你的分析和结论，提供初步核查建议。"
    )